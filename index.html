<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Abrir en navegador</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0;min-height:100vh;
           display:flex;align-items:center;justify-content:center;background:#0f172a;color:#e6eef8;padding:24px; }
    .card { max-width:520px;width:100%;background:#0b1220;border-radius:12px;padding:28px;box-shadow:0 8px 30px rgba(2,6,23,0.6); }
    h1{margin:0 0 12px;font-size:20px}
    p{margin:0 0 16px;line-height:1.45}
    .btn{display:inline-block;padding:12px 16px;border-radius:10px;background:#06b6d4;color:#012; text-decoration:none;font-weight:600;margin-right:8px;border:none;cursor:pointer}
    .secondary{background:transparent;color:#9fb6c6;border:1px solid rgba(159,182,198,0.12)}
    .hint{font-size:13px;color:#9fb6c6;margin-top:12px}
    .biglink{word-break:break-all;background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;margin-top:12px}
  </style>
</head>
<body>
  <div class="card" id="card">
    <h1>Abriendo en navegador...</h1>
    <p id="desc">Intentando abrir el enlace en el navegador externo. Si no funciona, sigue las indicaciones.</p>

    <div id="actions" style="margin-top:8px">
      <button class="btn" id="tryOpen">Abrir ahora</button>
      <button class="btn secondary" id="copyBtn">Copiar enlace</button>
      <a id="manualLink" class="btn secondary" style="display:none" href="#" target="_blank" rel="noopener noreferrer">Abrir en nueva pestaña</a>
    </div>

    <div id="manual" class="hint" style="display:none">
      Si sigue abriéndose dentro de TikTok: toca <strong>⋯</strong> (arriba/derecha) y elige <em>"Abrir en navegador"</em> (<em>Open in browser</em>) — o pega el enlace en Chrome/Safari.
    </div>

    <div class="biglink" id="biglink" style="display:none"></div>
  </div>

<script>
(function(){
  const target = 'https://t.me/+eYIupROZPCgyNDI0';
  const ua = navigator.userAgent || '';
  const isTikTok = /TikTok|musically|zhiliao/i.test(ua);
  const isAndroid = /Android/i.test(ua);
  const isIOS = /iPhone|iPad|iPod/i.test(ua);

  const card = document.getElementById('card');
  const desc = document.getElementById('desc');
  const tryOpen = document.getElementById('tryOpen');
  const copyBtn = document.getElementById('copyBtn');
  const manual = document.getElementById('manual');
  const biglink = document.getElementById('biglink');
  const manualLink = document.getElementById('manualLink');

  biglink.textContent = target;
  manualLink.href = target;
  manualLink.style.display = 'inline-block';

  if (!isTikTok) {
    desc.textContent = 'Parece que no vienes desde la app de TikTok. Si abriste este enlace desde TikTok, asegúrate de usar la URL que compartes en tu post.';
  } else {
    desc.textContent = 'Detectado: TikTok in-app browser. Vamos a intentar abrir en el navegador externo.';
    manual.style.display = 'block';
    biglink.style.display = 'block';
  }

  function attemptOpen() {
    // Intent (Android Chrome) — puede abrir Chrome u otro navegador
    if (isAndroid) {
      const hostPath = target.replace(/^https?:\/\//,'');
      // Intent con fallback
      const intentUrl = 'intent://' + hostPath + '#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url='
                        + encodeURIComponent(target) + ';end';
      // Primer intento con intent:
      window.location.href = intentUrl;
      // Fallback: si no se lanzó, abrir el https normal tras 1s
      setTimeout(function(){ window.location.href = target; }, 1200);
      return;
    }

    // iOS / otros: abrir en nueva pestaña (pero el in-app browser puede interceptar)
    try {
      const w = window.open(target, '_blank', 'noopener,noreferrer');
      if (w) {
        w.focus();
      } else {
        // popup bloqueado o in-app lo interceptó -> abrir en same window
        window.location.href = target;
      }
    } catch (e) {
      window.location.href = target;
    }

    // después de intentar, muestra instrucciones si seguimos en TikTok
    setTimeout(function(){
      if (isTikTok) {
        desc.textContent = 'Si el enlace sigue dentro de TikTok: toca ⋯ → "Abrir en navegador" (o copia el enlace y pégalo en Chrome/Safari).';
        manual.style.display = 'block';
        biglink.style.display = 'block';
      }
    }, 1000);
  }

  tryOpen.addEventListener('click', attemptOpen);

  copyBtn.addEventListener('click', function(){
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(target).then(function(){
        copyBtn.textContent = 'Enlace copiado ✓';
        setTimeout(()=> copyBtn.textContent = 'Copiar enlace',1600);
      }).catch(function(){
        window.prompt('Copia el enlace (Ctrl/Cmd+C):', target);
      });
    } else {
      window.prompt('Copia el enlace (Ctrl/Cmd+C):', target);
    }
  });

  // Auto-intent al cargar (intento transparente, pero el usuario seguirá viendo la página si no funciona)
  window.addEventListener('load', function(){
    // solo auto-intent si vienes de TikTok (evita malos comportamientos)
    if (isTikTok) {
      // no auto-ejecutar en todos los casos: espera 400ms para que el usuario vea la UI
      setTimeout(attemptOpen, 400);
    }
  });

})();
</script>
</body>
</html>

